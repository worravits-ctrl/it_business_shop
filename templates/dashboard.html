{% extends 'base.html' %}
{% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h1 class="display-6 fw-bold text-primary mb-0">
      <i class="fas fa-chart-line me-3"></i>Dashboard
    </h1>
    <p class="text-muted">ภาพรวมรายรับ-รายจ่ายของร้าน IT Business Shop</p>
  </div>
</div>

<!-- สถิติรายวัน -->
<div class="row mb-4">
  <div class="col-12">
    <h5 class="fw-bold mb-3">
      <i class="fas fa-calendar-day me-2 text-primary"></i>สถิติรายวัน (วันนี้)
    </h5>
  </div>
</div>

<div class="row mb-5">
  <div class="col-md-4">
    <div class="card stat-card income-card">
      <div class="stat-icon income-icon">
        <i class="fas fa-arrow-trend-up"></i>
      </div>
      <div class="stat-value text-success">{{ "{:,.0f}".format(t_inc) }}</div>
      <div class="stat-label">รายรับวันนี้</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card expense-card">
      <div class="stat-icon expense-icon">
        <i class="fas fa-arrow-trend-down"></i>
      </div>
      <div class="stat-value text-danger">{{ "{:,.0f}".format(t_exp) }}</div>
      <div class="stat-label">รายจ่ายวันนี้</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card profit-card">
      <div class="stat-icon profit-icon">
        <i class="fas fa-coins"></i>
      </div>
      <div class="stat-value {{ 'text-success' if t_net >= 0 else 'text-danger' }}">
        {{ "{:,.0f}".format(t_net) }}
      </div>
      <div class="stat-label">กำไรวันนี้</div>
    </div>
  </div>
</div>

<!-- สถิติรายเดือน -->
<div class="row mb-4">
  <div class="col-12">
    <h5 class="fw-bold mb-3">
      <i class="fas fa-calendar-alt me-2 text-primary"></i>สถิติรายเดือน (เดือนนี้)
    </h5>
  </div>
</div>

<div class="row mb-5">
  <div class="col-md-4">
    <div class="card stat-card income-card">
      <div class="stat-icon income-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-value text-success">{{ "{:,.0f}".format(m_inc) }}</div>
      <div class="stat-label">รายรับเดือนนี้</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card expense-card">
      <div class="stat-icon expense-icon">
        <i class="fas fa-chart-line-down"></i>
      </div>
      <div class="stat-value text-danger">{{ "{:,.0f}".format(m_exp) }}</div>
      <div class="stat-label">รายจ่ายเดือนนี้</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card profit-card">
      <div class="stat-icon profit-icon">
        <i class="fas fa-hand-holding-dollar"></i>
      </div>
      <div class="stat-value {{ 'text-success' if m_net >= 0 else 'text-danger' }}">
        {{ "{:,.0f}".format(m_net) }}
      </div>
      <div class="stat-label">กำไรเดือนนี้</div>
    </div>
  </div>
</div>

<!-- สถิติรายปี -->
<div class="row mb-4">
  <div class="col-12">
    <h5 class="fw-bold mb-3">
      <i class="fas fa-calendar me-2 text-primary"></i>สถิติรายปี (ปีนี้)
    </h5>
  </div>
</div>

<div class="row mb-5">
  <div class="col-md-4">
    <div class="card stat-card income-card">
      <div class="stat-icon income-icon">
        <i class="fas fa-chart-area"></i>
      </div>
      <div class="stat-value text-success">{{ "{:,.0f}".format(y_inc) }}</div>
      <div class="stat-label">รายรับปีนี้</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card expense-card">
      <div class="stat-icon expense-icon">
        <i class="fas fa-chart-area"></i>
      </div>
      <div class="stat-value text-danger">{{ "{:,.0f}".format(y_exp) }}</div>
      <div class="stat-label">รายจ่ายปีนี้</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card profit-card">
      <div class="stat-icon profit-icon">
        <i class="fas fa-trophy"></i>
      </div>
      <div class="stat-value {{ 'text-success' if y_net >= 0 else 'text-danger' }}">
        {{ "{:,.0f}".format(y_net) }}
      </div>
      <div class="stat-label">กำไรปีนี้</div>
    </div>
  </div>
</div>

<!-- กราฟแสดงแนวโน้ม -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="card-title mb-0">
          <i class="fas fa-chart-bar me-2"></i>แนวโน้มรายรับ-รายจ่าย (7 วันย้อนหลัง)
        </h5>
      </div>
      <div class="card-body">
        <canvas id="incomeExpenseChart" width="400" height="150"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- ปุ่มด่วน -->
<div class="row mt-5">
  <div class="col-12">
    <h5 class="fw-bold mb-3">
      <i class="fas fa-bolt me-2 text-warning"></i>เมนูด่วน
    </h5>
  </div>
</div>

<div class="row">
  <div class="col-md-3 col-sm-6 mb-3">
    <a href="{{ url_for('entry_new') }}" class="text-decoration-none">
      <div class="card text-center h-100" style="border-left: 5px solid #059669;">
        <div class="card-body">
          <i class="fas fa-plus-circle fa-2x text-success mb-3"></i>
          <h6 class="card-title">เพิ่มรายการใหม่</h6>
          <p class="card-text text-muted">บันทึกรายรับ-รายจ่าย</p>
        </div>
      </div>
    </a>
  </div>
  <div class="col-md-3 col-sm-6 mb-3">
    <a href="{{ url_for('entries') }}" class="text-decoration-none">
      <div class="card text-center h-100" style="border-left: 5px solid #2563eb;">
        <div class="card-body">
          <i class="fas fa-list fa-2x text-primary mb-3"></i>
          <h6 class="card-title">ดูรายการทั้งหมด</h6>
          <p class="card-text text-muted">รายการรายรับ-รายจ่าย</p>
        </div>
      </div>
    </a>
  </div>
  <div class="col-md-3 col-sm-6 mb-3">
    <a href="{{ url_for('export_csv') }}" class="text-decoration-none">
      <div class="card text-center h-100" style="border-left: 5px solid #d97706;">
        <div class="card-body">
          <i class="fas fa-file-export fa-2x text-warning mb-3"></i>
          <h6 class="card-title">ส่งออกข้อมูล</h6>
          <p class="card-text text-muted">ดาวน์โหลด CSV</p>
        </div>
      </div>
    </a>
  </div>
  <div class="col-md-3 col-sm-6 mb-3">
    <a href="{{ url_for('import_csv') }}" class="text-decoration-none">
      <div class="card text-center h-100" style="border-left: 5px solid #0891b2;">
        <div class="card-body">
          <i class="fas fa-file-import fa-2x text-info mb-3"></i>
          <h6 class="card-title">นำเข้าข้อมูล</h6>
          <p class="card-text text-muted">อัปโหลด CSV</p>
        </div>
      </div>
    </a>
  </div>
  <div class="col-md-3 col-sm-6 mb-3">
    <button onclick="deleteAllEntries()" class="text-decoration-none border-0 bg-transparent w-100 h-100">
      <div class="card text-center h-100" style="border-left: 5px solid #dc2626; cursor: pointer;">
        <div class="card-body">
          <i class="fas fa-trash-alt fa-2x text-danger mb-3"></i>
          <h6 class="card-title">ลบรายการทั้งหมด</h6>
          <p class="card-text text-muted">ล้างข้อมูลทั้งหมด</p>
        </div>
      </div>
    </button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('incomeExpenseChart').getContext('2d');
  
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ labels | safe }},
      datasets: [{
        label: 'รายรับ',
        data: {{ chart_incomes | safe }},
        borderColor: '#059669',
        backgroundColor: 'rgba(5, 150, 105, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4,
        pointBackgroundColor: '#059669',
        pointBorderColor: '#ffffff',
        pointBorderWidth: 2,
        pointRadius: 6
      }, {
        label: 'รายจ่าย',
        data: {{ chart_expenses | safe }},
        borderColor: '#dc2626',
        backgroundColor: 'rgba(220, 38, 38, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4,
        pointBackgroundColor: '#dc2626',
        pointBorderColor: '#ffffff',
        pointBorderWidth: 2,
        pointRadius: 6
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: {
              size: 14,
              weight: '600'
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(0, 0, 0, 0.1)'
          },
          ticks: {
            callback: function(value) {
              return value.toLocaleString() + ' ฿';
            },
            font: {
              size: 12
            }
          }
        },
        x: {
          grid: {
            color: 'rgba(0, 0, 0, 0.1)'
          },
          ticks: {
            font: {
              size: 12
            }
          }
        }
      },
      interaction: {
        intersect: false,
        mode: 'index'
      },
      elements: {
        point: {
          hoverRadius: 8
        }
      }
    }
  });
});
</script>
{% endblock %}
